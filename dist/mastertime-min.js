var Mastertime=function(){function t(){var t=this,e=-1,r=[],n={fullDateRegex:/([\d]{2}\.[\d]{2}\.[\d]{4})\ ([\d]{2}\:[\d]{2}\:[\d]{2})/,dateRegex:/([\d]{2}\.[\d]{2}\.[\d]{4})/,timeRegex:/([\d]{2}\:[\d]{2}\:[\d]{2})/};this._getRegex=function(t){return t?n[t]:n},this._getTimeBase=function(){return r},this._createTimeBaseRoom=function(){var t=r.length;return r[t]=[],t},this._putTimeBaseRoom=function(t,e){r[t].push(e)},this._getLastRoomIndex=function(){return e},this._setLastRoomIndex=function(t){e=t},this._resetLastRoomIndex=function(){e=-1},this._attrToProp=function(t){return(t=t.substr(2,t.length))[0].toLowerCase()+t.slice(1,t.length)},this._wayDetector=function(e){if("string"!=typeof e.start||isNaN(parseInt(e.start))||(e.start=parseInt(e.start)),"string"!=typeof e.end||isNaN(parseInt(e.end))||(e.end=parseInt(e.end)),Number.isInteger(e.start))Number.isInteger(e.end)?e.start>e.end?e.way="down":e.way="up":e.way||(e.end=e.start>0?0:1/0,e.way=e.start>0?"down":"up");else if(e.date){var r=t._dateDiff(e.date);r=r<0?-r:r,t._dateDiff(e.date)<0?e.way="up":e.way="down",e.start=Math.floor(r)}return e},this._leftPad=function(t,e){if(!e||!e.leftPad)return t;var r;r=!0===e.leftPad?["Y","M","W","D","h","m","s"]:e.leftPad.split(":");var n,a={};for(n in t)r.indexOf(n)>-1&&(a[n]=parseInt(t[n])<10?"0"+t[n]:t[n]);return Object.assign(t,a),t},this._dateComplete=function(e){var r,n,a;return(r=t._getRegex("fullDateRegex").exec(e))?r[0]:(n=t._getRegex("dateRegex").exec(e))?n[0]+" 00:00:00":(a=t._getRegex("timeRegex").exec(e))?(new Date).toLocaleDateString()+" "+a[0]:(new Date).toLocaleString()},this._dateFormat=function(e){if(!t._getRegex("fullDateRegex").exec(e))return e;var r=e.split(" "),n=r[0],a=r[1],i=n.split("."),o=i[0],s=i[1],m=i[2];return(s=["January","February","March","April","May","June","July","August","September","October","November","December"][Number(s)-1])+" "+o+", "+m+" "+a},this._dateDiff=function(e){return e?(e=t._dateFormat(t._dateComplete(e)),(new Date(e).getTime()-(new Date).getTime())/1e3):0},this._templateApply=function(e,r,n){"string"==typeof e&&e.trim().length<1?e="{h}:{m}:{s}":e||(e="{h}:{m}:{s}");var a,i,o;for(a in n&&n.leftPad&&(r=t._leftPad(r,n)),r)e=(o=new RegExp("\\/(\\[[^\\!&^\\[&^\\]]*)\\{(.)\\}([^\\[&^\\]]*)\\/(\\])".replace(".",a),"gmi")).exec(e)?0===parseInt(r[a])?e.replace(o,""):e.replace(o,"$1"+r[a]+"$3"):(i=new RegExp("[^\\/&^\\[]{0}\\[([^\\&^\\[&^\\]]*)\\{(.)\\}([^\\[]*)[^\\/]\\]".replace(".",a),"gmi")).exec(e)?e.replace(i,"$1"+r[a]+"$3$4"):e.replace("{"+a+"}",r[a]);return e},this._timeFormat=function(t,e){"number"!=typeof t&&(t=parseInt(t)),isNaN(t)&&(t=0);var r,n,a={Y:31556926,M:2629743.83,W:604800,D:86400,h:3600,m:60,s:1};r=e?e.timeFormat.split(":"):["Y","M","W","D","h","m","s"];var i={};for(n in a)r.indexOf(n)>-1&&(i[n]=Math.floor(t/a[n]).toString(),t%=a[n]);return i},this._machine=function(e){"number"!=typeof e.start&&clearInterval(e.process),"number"==typeof e.start||e.date||clearInterval(e.process);var r={timeFormat:e.date?"Y:M:W:D:h:m:s":"h:m:s",leftPad:!!e.date&&"h:m:s"};if(e.config=Object.assign({},r,e.config),e.onInterval&&e.onInterval(e),e.target){var n=e.target;e.template||(e.template="INPUT"===n.tagName?n.value:n.innerHTML);var a=t._templateApply(e.template,t._timeFormat(e.start,e.config),e.config);"INPUT"===n.tagName?n.value!==a&&(n.value=a):n.innerHTML!==a&&(n.innerHTML=a)}if(e.start===e.end)return clearInterval(e.process),e.onEnd&&e.onEnd(e),!0;"up"===e.way?e.start++:e.start--}}return t.prototype.add=function(t){if(!t)return this;for(var e,r=this._createTimeBaseRoom(),n=0,a=(e=Array.isArray(t)?t:[t]).length;n<a;n++){var i=this._wayDetector(e[n]);if(i.start||i.date){if(i.target)for(var o=document.querySelectorAll(i.target),s=0,m=o.length;s<m;s++){var f=o[s],u=Object.assign({},i,{target:f,template:i.template});this._putTimeBaseRoom(r,u)}else this._putTimeBaseRoom(r,Object.assign({},i));return this._setLastRoomIndex(r),this}}},t.prototype.build=function(t,e){if(!t)return this;var r;if("string"==typeof t)r=document.querySelectorAll(t);else if(t.tagName)r=[t];else{if(!t.length)return this;r=t}if(!r.length)return this;for(var n=this._createTimeBaseRoom(),a=["mtDate","mtStart","mtEnd","mtOnStart","mtOnInterval","mtOnEnd","mtName","mtTemplate","mtWay","mtAgo"],i=0,o=r.length;i<o;i++){for(var s=r[i],m={},f=0,u=a.length;f<u;f++){var l=s.getAttribute(a[f]);if(l)s.removeAttribute(a[f]),m[this._attrToProp(a[f])]=l}if(m.start||m.date){var c={};m.onStart&&"string"==typeof m.onStart&&(c.onStart=new Function("event",m.onStart)),m.onInterval&&"string"==typeof m.onInterval&&(c.onInterval=new Function("event",m.onInterval)),m.onEnd&&"string"==typeof m.onEnd&&(c.onEnd=new Function("event",m.onEnd));var g=Object.assign({},this._wayDetector(m),c,{target:s,config:e});this._putTimeBaseRoom(n,g)}}return this._setLastRoomIndex(n),this},t.prototype.run=function(){var t=this,e=this._getLastRoomIndex();if(-1===e)return!1;for(var r=this._getTimeBase()[e],n=0,a=r.length,i=function(){var e=r[n];e.onStart&&e.onStart(e),o._machine(e),e.process=setInterval(function(){return t._machine(e)},1e3)},o=this;n<a;n++)i();this._resetLastRoomIndex()},t.prototype.destroy=function(t){if(!t||"string"!=typeof t)return!1;var e=this._getTimeBase();if(!e||!Array.isArray(e)||!e.length)return!1;for(var r=0,n=e.length;r<n;r++){var a=0,i=e[r].length,o=e[r];if(o&&i)for(;a<i;a++){var s=o[a];s.hasOwnProperty("name")&&t===s.name&&clearInterval(s.process)}}},t}();